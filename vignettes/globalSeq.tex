%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{globalSeq}
%\VignetteEncoding{UTF-8}
\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\setlength\parindent{0pt}
\usepackage{hyperref}
\hypersetup{colorlinks = true,allcolors = blue}
\usepackage{amsmath}
\title{globalSeq: testing for association between \mbox{RNA-Seq} and high-dimensional data}
\date{\today}
\author{\textbf{A Rauschenberger}, \textbf{MA Jonker}, \textbf{MA van de Wiel} \\ and \textbf{RX Menezes}}
\bibliographystyle{plain}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}
\maketitle

This vignette explains how to use the R~package \textbf{globalSeq}. The function \hyperref[omnibus]{\mbox{omnibus}} tests  for associations between an overdispersed count variable and a high-dimensional covariate set. The function \hyperref[proprius]{\mbox{proprius}} decomposes the test statistic to show the contributions of individual samples or covariates. And the function \hyperref[cursus]{\mbox{cursus}} performs genome-wide analyses.

\section{Initialisation}
\label{initialisation}

Start with installing the R package \textbf{globalSeq} from Bioconductor:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{source}\hlstd{(}\hlstr{"https://bioconductor.org/biocLite.R"}\hlstd{)}
\hlstd{BiocInstaller}\hlopt{::}\hlkwd{biocLite}\hlstd{(}\hlstr{"globalSeq"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

Please type the following command to load and attach the package:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(globalSeq)}
\end{alltt}
\end{kframe}
\end{knitrout}

If you want to reproduce the examples, you should attach the toy database:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{attach}\hlstd{(toydata)}
\end{alltt}
\end{kframe}
\end{knitrout}

% alternative to the function "attach"


The following commands access the R documentation:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{utils}\hlopt{::}\hlkwd{help}\hlstd{(globalSeq)}
\hlstd{utils}\hlopt{::}\hlkwd{vignette}\hlstd{(}\hlstr{"globalSeq"}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%
\section{Test of association} %%%
\label{omnibus} %%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Data}
\label{omnibus_data}

Data is available for 10~individuals and 16~variables.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{cbind}\hlstd{(y,X)}
\end{alltt}
\begin{verbatim}
##        y X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 X12 X13 X14 X15
## ind1   7  0  1  0  0  0  0  1  1  1   0   1   0   0   1   0
## ind2   1  1  1  0 17 15 16 13 10 20   0   1   0   1   1   0
## ind3   1  0  1  0  0  0  1  1  1  0   0   0   0   0   0   1
## ind4  15 17 18 16 12 15 20 14 17 18  17  15   0   1   0  13
## ind5   6  1  1  0  0  0  1  1  1  1   1   1   0   1   1   1
## ind6  16 12 14 13 12 10 15 18 17 12  15  12   0   0   0  15
## ind7   5  0  0  1  1  0  0  1  0  0   0   0   1   1   1   1
## ind8   2  0  1  1  0  0  0  1  0  0   0   0   0   1   1   1
## ind9   2  1  1  1  1  0  0  0  1  1   0   0   0   0   1   1
## ind10  5  1  0  1  0  1  0  0  1  1   1   0   0   0   0   0
\end{verbatim}
\end{kframe}
\end{knitrout}

\subsection{Minimal example}
\label{omnibus_minimal_example}

We are interested whether the response variable~$\boldsymbol{y}$ is associated with the covariate matrix~$\boldsymbol{X}$. Looking at the data might already lead to an answer.\footnote{Note that the response variable takes higher values for individuals~$4$ and~$6$ than for the other individuals. Looking at the covariate matrix, we observe that individuals~$2$, $4$ and~$6$ are peculiar.
We conclude: The data on individuals~$4$ and~$6$ speak for an association, but the data on individual~$2$ speaks against an association. Covariates~$12$, $13$ and~$14$ are uninformative, and the role of other covariates is less clear.}

Because the number of covariates exceeds the sample size, classical tests cannot test their joint significance. But the function \textbf{omnibus} also works in high-dimensional settings:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{omnibus}\hlstd{(y,X)}
\end{alltt}
\begin{verbatim}
##   pvalue teststat covs
## 1  0.024 651.6189   15
\end{verbatim}
\end{kframe}
\end{knitrout}

\newpage

\subsection{Offset}
\label{omnibus_offset}

Suppose that an offset is available. Relative to the offset, the response~$\boldsymbol{y}$ is more or less constant across samples:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{rbind}\hlstd{(y,offset)}
\end{alltt}
\begin{verbatim}
##        ind1 ind2 ind3 ind4 ind5 ind6 ind7 ind8 ind9 ind10
## y         7    1    1   15    6   16    5    2    2     5
## offset   15    1    2   28   10   28    9    2    5     7
\end{verbatim}
\end{kframe}
\end{knitrout}

If we account for this offset, there is no evidence for an association between the response~$\boldsymbol{y}$ and the covariate matrix~$\boldsymbol{X}$:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{omnibus}\hlstd{(y,X,}\hlkwc{offset}\hlstd{=offset)}
\end{alltt}
\begin{verbatim}
##   pvalue  teststat covs
## 1  0.977 -2881.224   15
\end{verbatim}
\end{kframe}
\end{knitrout}

\subsection{Confounding variable}
\label{omnibus_confounding_variable}

Suppose that each sample belongs either to group~$1$ or to group~$2$. We can observe that $\boldsymbol{y}$ tends to take small values in one group, and large values in the other:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{rbind}\hlstd{(y,group)}
\end{alltt}
\begin{verbatim}
##       ind1 ind2 ind3 ind4 ind5 ind6 ind7 ind8 ind9 ind10
## y        7    1    1   15    6   16    5    2    2     5
## group    1    1    1    2    1    2    1    1    1     1
\end{verbatim}
\end{kframe}
\end{knitrout}

We suspect that the group membership explains some variation of the response~$\boldsymbol{y}$ or the covariate matrix~$\boldsymbol{X}$. Therefore we account for this confounding variable by using stratified permutations:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{omnibus}\hlstd{(y,X,}\hlkwc{group}\hlstd{=group)}
\end{alltt}
\begin{verbatim}
##      pvalue teststat covs
## 1 0.8947368 651.6189   15
\end{verbatim}
\end{kframe}
\end{knitrout}

\newpage

\subsection{Overdisperion}
\label{omnibus_overdispersion}

Setting the dispersion parameter of the negative binomial distribution equal to zero is equivalent to using the Poisson distribution:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{omnibus}\hlstd{(y,X,}\hlkwc{phi}\hlstd{=}\hlnum{0}\hlstd{)}
\end{alltt}
\begin{verbatim}
##   pvalue teststat covs
## 1  0.024 21877.03   15
\end{verbatim}
\end{kframe}
\end{knitrout}

\subsection{Multiple covariate sets}
\label{omnibus_multiple_covariate_sets}

Suppose that two covariate sets are available:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{X1} \hlkwb{<-} \hlstd{X[,}\hlkwd{c}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{11}\hlstd{,}\hlnum{15}\hlstd{)]}
\hlstd{X2} \hlkwb{<-} \hlstd{X[,}\hlnum{12}\hlopt{:}\hlnum{14}\hlstd{]}
\end{alltt}
\end{kframe}
\end{knitrout}

We are interested in testing for associations between $\boldsymbol{y}$ on one hand, and $\boldsymbol{X1}$ or $\boldsymbol{X2}$ on the other:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{omnibus}\hlstd{(y,}\hlkwd{list}\hlstd{(X1,X2))}
\end{alltt}
\begin{verbatim}
##   joint teststat single.1 single.2 covs.1 covs.2
## 1 0.029 3.448796    0.024    0.284     12      3
\end{verbatim}
\end{kframe}
\end{knitrout}
The output includes the \mbox{$p$-value} and the test statistic for the joint test, the \mbox{$p$-values} for the individual tests, and the numbers of tested covariates.

\subsection{P-values}
\label{omnibus_p_values}

When testing single covariate sets, the user can choose between three different types of \mbox{$p$-values}. By default \mbox{$p$-values} are calculated by permutation without repetitions (${\verb+kind+=1}$). Alternatively, permutation can be interrupted when it becomes impossible to reach a predefined significance level (${0 < \verb+kind+ < 1}$), or the method of control variables can be used (${\verb+kind+=0}$).

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{omnibus}\hlstd{(y,X,}\hlkwc{kind}\hlstd{=}\hlnum{1}\hlstd{)} \hlcom{# crude permutation test}
\hlkwd{omnibus}\hlstd{(y,X,}\hlkwc{kind}\hlstd{=}\hlnum{0.05}\hlstd{)} \hlcom{# interrupting permutation}
\hlkwd{omnibus}\hlstd{(y,X,}\hlkwc{kind}\hlstd{=}\hlnum{0}\hlstd{)} \hlcom{# method of control variables}
\end{alltt}
\end{kframe}
\end{knitrout}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%
\section{Decomposition} %%%%%%%%%
\label{proprius} %%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Minimal example}
\label{proprius_minimal_example}

Even though a single hypothesis is tested on the covariate set, the function \textbf{proprius} can obtain the contributions of individual covariates or samples to the test statistic. 
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{proprius}\hlstd{(y,X,}\hlkwc{type}\hlstd{=}\hlstr{"samples"}\hlstd{)}
\hlkwd{proprius}\hlstd{(y,X,}\hlkwc{type}\hlstd{=}\hlstr{"covariates"}\hlstd{)}
\end{alltt}
\end{kframe}
\includegraphics[width=\maxwidth]{figure/unnamed-chunk-16-1} 
\includegraphics[width=\maxwidth]{figure/unnamed-chunk-16-2} 

\end{knitrout}

We observe that individual~$2$ contributes negatively to the test statistic, whereas the contributions of individuals~$4$ and $6$ are positive. We also observe that several covariates have large positive contributions. Summing over the individual contributions gives back the test statistic.


\subsection{Null distribution}
\label{proprius_null_distribution}

If a significance level~$\alpha$ is specified, then the \mbox{$1-\alpha$}~lower quantile under the null hypothesis is plotted:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{proprius}\hlstd{(y,X,}\hlkwc{type}\hlstd{=}\hlstr{"covariates"}\hlstd{,}\hlkwc{alpha}\hlstd{=}\hlnum{0.05}\hlstd{)}
\end{alltt}
\end{kframe}
\includegraphics[width=\maxwidth]{figure/unnamed-chunk-17-1} 

\end{knitrout}

\subsection{Further arguments}
\label{proprius_further_arguments}

Offsets are included as in section~\ref{omnibus_offset}, confounding variables are taken into account as in section~\ref{omnibus_confounding_variable}, and overdispersion is treated as in section~\ref{omnibus_overdispersion}. The decompositions have not been implemented for multiple covariate sets.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%
\section{Genome-wide analysis} %%
\label{cursus} %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Data}
\label{cursus_data}

Suppose the matrix~$\boldsymbol{Y}$ contains expression levels of 7~genes and 5~individuals, and the matrices~$\boldsymbol{V}$ and~$\boldsymbol{W}$ represent two different molecular profiles. Suppose that we furthermore know the locations of the genes ($\boldsymbol{Yloc}$), the locations of the genetic or epigenetic alterations ($\boldsymbol{Vloc}$ and $\boldsymbol{Wloc}$), and the chromosome indicators $\boldsymbol{Ychr}$, $\boldsymbol{Vchr}$ and $\boldsymbol{Wchr}$.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{cbind}\hlstd{(Yloc,Ychr,Y)}
\end{alltt}
\begin{verbatim}
##       Yloc Ychr ind1 ind2 ind3 ind4 ind5
## gene1    9    1    9   55    7   32   25
## gene2   32    1   10    6   13   11   13
## gene3   39    1    5   15   30   29   44
## gene4   70    1   11   51    4    9   40
## gene5   75    1   18   20   50   20    5
## gene6   77    1   16    1    4   37   33
## gene7   96    1    1   30   25    6    2
\end{verbatim}
\begin{alltt}
\hlkwd{cbind}\hlstd{(Vloc,Vchr,V)}
\end{alltt}
\begin{verbatim}
##     Vloc Vchr ind1 ind2 ind3 ind4 ind5
## V1    27    1  1.1  0.8 -1.4  0.0 -0.9
## V2    38    1  2.8  1.7  0.1 -0.1 -1.5
## V3    39    1 -0.7  0.3 -0.3  1.1  0.3
## V4    47    1  1.3  0.1  0.7 -0.5  0.3
## V5    65    1 -0.2  0.2  0.9  1.3  0.3
## V6    66    1  0.9 -0.5  0.1  0.2  0.9
## V7    68    1  0.1  0.9  0.5 -0.4  2.5
## V8    79    1 -0.6  0.1  0.2  0.2 -1.5
## V9    81    1 -0.6 -1.0  0.6 -0.2 -0.4
## V10   93    1  0.2  0.1 -0.8  1.0 -0.8
\end{verbatim}
\begin{alltt}
\hlkwd{cbind}\hlstd{(Wloc,Wchr,W)}
\end{alltt}
\begin{verbatim}
##    Wloc Wchr ind1 ind2 ind3 ind4 ind5
## W1    2    1    0    2    1    0    2
## W2   23    1    2    1    0    1    1
## W3   35    1    1    0    1    1    1
## W4   45    1    1    0    2    1    1
## W5   71    1    1    1    1    0    0
## W6   86    1    0    1    2    0    2
## W7   92    1    0    2    1    1    2
## W8  100    1    2    1    1    1    1
\end{verbatim}
\end{kframe}
\end{knitrout}

\subsection{Minimal example}
\label{cursus_minimal_example}

We are interested in testing the expression of each gene for associations with \textit{local} genetic or epigenetic alterations.

Setting the argument window to~$5$ entails that each gene is tested for association with all covariates that are located no further than $5$~units from the gene. In this example the covariates of interest are:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{verbatim}
## gene1:  
## gene2:  
## gene3: V2 V3 
## gene4: V6 V7 
## gene5: V8 
## gene6: V8 V9 
## gene7: V10
\end{verbatim}
\end{kframe}
\end{knitrout}

The chromosome-wide analysis will not return any \mbox{$p$-value} for genes~$1$ and $2$, because no covariates are in their vicinity.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{cursus}\hlstd{(Y,Yloc,V,Vloc,}\hlkwc{window}\hlstd{=}\hlnum{5}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}

\subsection{Multiple chromosomes}
\label{cursus_mutiple_chromosomes}

If multiple chromosomes are analysed, it is important to include the chromosome indicators. They make sure that genes are mapped to covariates on the same chromosome:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{cursus}\hlstd{(Y,Yloc,V,Vloc,}\hlkwc{window}\hlstd{=}\hlnum{5}\hlstd{,Ychr,Vchr)}
\end{alltt}
\end{kframe}
\end{knitrout}

\subsection{Different library sizes}
\label{cursus_different_library_sizes}

To account for different sequencing depths, an offset can be included:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{offset} \hlkwb{<-} \hlkwd{colSums}\hlstd{(Y)} \hlcom{# library sizes}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{cursus}\hlstd{(Y,Yloc,V,Vloc,}\hlkwc{window}\hlstd{=}\hlnum{5}\hlstd{,}\hlkwc{offset}\hlstd{=offset)}
\end{alltt}
\end{kframe}
\end{knitrout}
Otherwise the offset is calculated based on $\boldsymbol{Y}$.

\newpage

\subsection{Multiple molecular profiles}
\label{cursus_multiple_molecular_profiles}

For the simultaneous analysis of multiple molecular profiles, the function \textbf{cursus} expects one covariate matrix, one location vector and one window size for each profile.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{set.seed}\hlstd{(}\hlnum{1}\hlstd{)}
\hlkwd{cursus}\hlstd{(Y,Yloc,}\hlkwd{list}\hlstd{(V,W),}\hlkwd{list}\hlstd{(Vloc,Wloc),}\hlkwd{list}\hlstd{(}\hlnum{5}\hlstd{,}\hlnum{50}\hlstd{))}
\end{alltt}
\begin{verbatim}
##           joint   teststat   single.1  single.2 covs.1 covs.2
## gene1        NA        NaN         NA 0.2000000      0      4
## gene2 0.3916667  0.3162150 0.78333333 0.1250000      1      5
## gene3 0.0500000  2.3485357 0.03333333 0.5166667      2      6
## gene4 0.6000000 -0.5383582 0.55000000 0.6750000      3      7
## gene5 0.3666667  0.3000674 0.30000000 0.5250000      1      6
## gene6 0.4333333 -0.1737118 0.74166667 0.3583333      2      6
## gene7 0.7583333 -1.2972658 0.70000000 0.8166667      1      4
\end{verbatim}
\end{kframe}
\end{knitrout}

\subsection{Further arguments}
\label{cursus_further_arguments}

Confounding variables are taken into account as in section~\ref{omnibus_confounding_variable}. By setting ${\verb+phi=rep(0,q)+}$ where \verb+q+ is the number of genes, the user can restrict the negative binomial distribution to the Poisson distribution. By default, offsets and dispersion parameters are calculated internally, but they can also be inserted. The following example uses the R package \textbf{edgeR} from Bioconductor:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{list} \hlkwb{<-} \hlstd{edgeR}\hlopt{::}\hlkwd{DGEList}\hlstd{(Y)}
\hlstd{list} \hlkwb{<-} \hlstd{edgeR}\hlopt{::}\hlkwd{calcNormFactors}\hlstd{(list)}
\hlstd{list} \hlkwb{<-} \hlstd{edgeR}\hlopt{::}\hlkwd{estimateDisp}\hlstd{(list)}

\hlstd{lib.size} \hlkwb{<-} \hlkwd{colSums}\hlstd{(Y)}
\hlstd{offset} \hlkwb{<-} \hlstd{lib.size}\hlopt{/}\hlkwd{exp}\hlstd{(}\hlkwd{mean}\hlstd{(}\hlkwd{log}\hlstd{(lib.size)))}
\hlstd{norm.factors} \hlkwb{<-} \hlstd{list}\hlopt{$}\hlstd{samples}\hlopt{$}\hlstd{norm.factors}
\hlstd{offset} \hlkwb{<-} \hlstd{norm.factors}\hlopt{*}\hlstd{offset}

\hlstd{phi} \hlkwb{<-} \hlstd{list}\hlopt{$}\hlstd{tagwise.dispersion}

\hlkwd{cursus}\hlstd{(Y,Yloc,V,Vloc,}\hlkwc{window}\hlstd{=}\hlnum{5}\hlstd{,}\hlkwc{offset}\hlstd{=offset,}\hlkwc{phi}\hlstd{=phi)}
\end{alltt}
\end{kframe}
\end{knitrout}

\newpage

\section*{References}

The R package \textbf{globalSeq} is based on Rauschenberger et al.~\cite{Rauschenberger2016}, where detailed references to previous work are given. If you use \textbf{globalSeq} for publications, please cite Rauschenberger et al.~\cite{Rauschenberger2016}.
\newline \newline
Based on calculations from le Cessie and van Houwelingen~\cite{leCessie1995} and using the generalised linear modelling framework from McCullagh et al.~\cite{McCullagh1989}, 
Goeman et al.~\cite{Goeman2004} showed how to test for association between a response variable from the exponential family of distributions and a high-dimensional covariate set, and derived the contributions of samples and covariates to the test statistic.
Menezes et al.~\cite{Menezes2016} extended this test to multiple covariate sets.
Rauschenberger et al.~\cite{Rauschenberger2016} adapted the methods from Goeman et al.~\cite{Goeman2004} and Menezes et al.~\cite{Menezes2016} to the negative binomial distribution with an unknown dispersion parameter.
This permutation test was made computationally efficient using ideas from Wieringen et al.~\cite{Wieringen2008} and Senchaudhuri et al.~\cite{Senchaudhuri1995}.

\begingroup
\renewcommand{\section}[2]{}
\bibliography{references}
\endgroup

\end{document}
